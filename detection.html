<!DOCTYPE html>
<html>
<head>
<script src="js/Tangibles.js"></script>

<script>


	
function myFunction() {
    document.getElementById("textLoadTangibles").innerHTML = populate();
	document.getElementById("textCalibrate").innerHTML = ' ';
	document.getElementById("textRecognize").innerHTML = ' ';
	document.getElementById("textReorientate").innerHTML = ' ';
};

function populate(){
	return testPopulateC();
};

function save(){
	return testSave();
};

function recognize(){
	var touches =[[350,650],[250,150],[150,500],[550,650]];  
	// [[15,50],[35,65],[25,15],[55,65]]; //with touch points not in order  translation by x=5,y=10 //[[0,0],[0,30],[40,0]];
	var identifiedTangible = tangibleRecognizer(touches);
	var jsonText = JSON.stringify(identifiedTangible);
	document.getElementById("textLoadTangibles").innerHTML = jsonText;
	document.getElementById("textCalibrate").innerHTML = ' ';
	document.getElementById("textRecognize").innerHTML = ' ';
	document.getElementById("textReorientate").innerHTML = ' ';
};

function testReorientate(){
	//var touches =[[25,15],[15,50],[35,65],[55,65]]; // [[20,5],[10,40],[30,55],[50,55]];  //[[0,0],[0,30],[40,0]];
	//var identifiedTangible = tangibleRecognizer(touches);
	var stickNew = new Tangible();
	id=6;
	tangibleName='another boar';
	touchPoints=[[150,500],[250,150],[550,650],[350,650]]; 
	//[[15,50],[25,15],[35,65],[55,65]];//[[25,15],[15,50],[35,65],[55,65]]; // touch points are in original order translation by x=5,y=1
	//[[15,50],[35,65],[25,15],[55,65]]; //with touch points not in order  translation by x=5,y=10[[25,15],[15,50],[35,65],[55,65]];  // [[20,5],[10,40],[30,55],[50,55]];  //[[0,0],[0,30],[40,0]];
	outline=[];
	stickNew=stickNew.populateC(id,tangibleName,touchPoints,outline);
	
	
	var jsonText = JSON.stringify(stickNew);
	document.getElementById("textLoadTangibles").innerHTML = jsonText;
	var firsttime=true;
	var freezeOutline=true;
	var g=[];
	
	
	//Recognize
	var identifiedTangible = tangibleRecognizer(touchPoints);
	var jsonText = JSON.stringify(identifiedTangible);
	document.getElementById("textRecognize").innerHTML = jsonText;
	
	//ReOrientate
	var pose=reorientate(identifiedTangible, stickNew, g, firsttime, freezeOutline);
	var jsonText2 = JSON.stringify(pose);
	document.getElementById("textReorientate").innerHTML = jsonText2;
	document.getElementById("textCalibrate").innerHTML = ' ';


};

function Load(){
	return testPopulateC();
};

function testCalculateDistances(){
	var leaf = new Tangible();
	leaf.type = "leaf";
	leaf.ID=1;
	leaf.touchPoints[0]=[0,0];
	leaf.touchPoints[1]=[0,400];
	leaf.touchPoints[2]=[300,0];
	return leaf.calculateDistances();
};

//Test method for Calibration Constructor
function testPopulateC(){
	var leaf = new Tangible();
	// Method arguments id,  name,  touches,  outline
	var id=1;
	var tangibleName='leaf';
	var touchPoints=[[100,100],[100,400],[500,100]];
	var outline=[[0,0],[0,500],[600,0]];
	return leaf.populateC(id,tangibleName,touchPoints,outline); 
	 
};

function testSave(){

	var savingTangibles= JSON.parse(localStorage.getItem('tangibles'));
	
	var leaf = new Tangible();
	// Method arguments id,  name,  touches,  outline
	var id=0;
	var tangibleName='Leaf';
	var touchPoints=[[100,100],[100,400],[500,100]];
	var outline=[];
	leaf.populateC(id,tangibleName,touchPoints,outline); 
	savingTangibles.push(leaf);
	
	var stick = new Tangible();
	// Method arguments id,  name,  touches,  outline
	id=1;
	tangibleName='Stick';
	touchPoints=[[100,150],[100,400],[100,550]];
	outline=[];
	stick.populateC(id,tangibleName,touchPoints,outline); 
	savingTangibles.push(stick);
	
	var stick = new Tangible();
	// Method arguments id,  name,  touches,  outline
	id=2;
	tangibleName='Boar';
	touchPoints=[[200,50],[100,400],[300,550],[500,550]];
	outline=[];
	stick.populateC(id,tangibleName,touchPoints,outline); 
	savingTangibles.push(stick);
	
	localStorage.setItem('tangibles', JSON.stringify(savingTangibles));

	// Example of how to transform the String generated through 
	// JSON.stringify and saved in localStorage in JSON object again
	tangiblesList= JSON.parse(localStorage.getItem('tangibles'));
	var jsonText = JSON.stringify(tangiblesList);
	document.getElementById("textLoadTangibles").innerHTML = jsonText;
	document.getElementById("textCalibrate").innerHTML = ' ';
	document.getElementById("textRecognize").innerHTML = ' ';
	document.getElementById("textReorientate").innerHTML = ' ';
};

//Test method for Tangible Identification Constructor
function testPopulateI(){
	var leaf = new Tangible();
	// Method arguments touch points
	var touchPoints=[[100,100],[100,500],[400,100]];
	var outline=[];
	return leaf.populateI(touchPoints); 
	
};

function addNewTangible(){
	var stick2 = new Tangible();
	// Method arguments id,  name,  touches,  outline
	//var id=1;
	var tangibleName='stick2';
	var touchPoints=[[120,150],[1210,400],[560,130]];
	var orientation =0;
	//leaf.populateC(id,tangibleName,touchPoints,outline); 
	tangiblesList= JSON.parse(localStorage.getItem('tangibles'));
	Save(tangiblesList, orientation, touchPoints, tangibleName);
};


function testIsOverlapped(){
	
	tangiblesList= JSON.parse(localStorage.getItem('tangibles'));
	var identifiedTangible1=tangiblesList[0];
	var identifiedTangible2=tangiblesList[2];
	
	//Assume we have already have an identified tangible saved in identifiedTangible1
	// Add the identified tangible to identifiedTangiblesList
	var index=-1;	
	var imageElementID1=1;
	index=addIdentifiedTangibles(identifiedTangible1,imageElementID1);
	// update the positions of identifiedTangible1's current touch points 
	var touchPointsIdentifiedTangible1=[[120,150],[1210,400],[560,130]];
	updatePosition(index,touchPointsIdentifiedTangible1);
	
	//Assume we have already have an another identified tangible saved in identifiedTangible2
	// Add the identified tangible2
	var imageElementID2=2;
	index=addIdentifiedTangibles(identifiedTangible2,imageElementID2);
	// update the positions of identifiedTangible2's current touch points 
	var touchPointsIdentifiedTangible2=[[200,50],[100,400],[300,550],[500,550]];
	updatePosition(index,touchPointsIdentifiedTangible2);
	
	// Assume we have a newly identified tangible but now we need to verify that the user haven't pressed the tangible on
	// a new Tangible's touch points
	var newTangibleTouchPoints=[[120,144],[1210,403],[560,128]];//[[97,402],[296,544],[203,58],[496,559]];//[[203,58],[97,402],[296,544],[496,559]];//[[200,50],[100,400],[300,550],[500,550]];
	//[[121,152],[1216,396],[561,121]];//[[120,150],[1210,400],[560,130]];
	var cen = [];
          cen[0] = 0;
          cen[1] = 0;

          for (i=0; i<newTangibleTouchPoints.length; i++){
            cen[0] += newTangibleTouchPoints[i][0];
            cen[1] += newTangibleTouchPoints[i][1];
          }
          cen[0] = cen[0]/3;
          cen[1] = cen[1]/3;
	console.log('new TouchPoints center:'+JSON.stringify(cen));	  
	// Check the new Tangible is overlapping on top of a previously identified one
	var result = isOverlapped(newTangibleTouchPoints,3,cen);
	
	// Showing the result
	var jsonText = JSON.stringify(result);
	
	/* Retrieve whole element form the identifiedTangiblesList using the result[1]
	 Structure of identifiedTangiblesList is as follows
	 var identifiedTangible=identifiedTangiblesList[i]
	 identifiedTangible[0] : The imageElementID for UI  [integer]           1
	 identifiedTangible[1] : Original tangible object   [Tangible Object]  {"type":"leaf","ID":0,"touchPoints":[[100,100],[100,400],[500,100]],"outlinePoints":[],"distances":[300,400,500],"map":[[[100,100],[[100,400],[500,100]],[300,400]],[[100,400],[[500,100]],[500]],[[500,100],[],[]]],"transformation":[]}
	 identifiedTangible[2] : Latest set of touch points [Array]            [[120,150],[1210,400],[560,130]]
 	 */
	  
	var result2=identifiedTangiblesList[result[1]];
	var jsonText2 = JSON.stringify(result2);
	document.getElementById("textLoadTangibles").innerHTML = jsonText;
	document.getElementById("textCalibrate").innerHTML =jsonText2;
	document.getElementById("textRecognize").innerHTML = ' ';
	document.getElementById("textReorientate").innerHTML = ' ';
	
};

function deleteTangibles(){

	tangiblesList= [];
	localStorage.setItem('tangibles', JSON.stringify(tangiblesList));
	
	
};

function loadTangibles(){
	tangiblesList=JSON.parse(localStorage.getItem('tangibles'));
	var jsonText = JSON.stringify(tangiblesList);
	document.getElementById("textLoadTangibles").innerHTML = jsonText;
	document.getElementById("textCalibrate").innerHTML = ' ';
	document.getElementById("textRecognize").innerHTML = ' ';
	document.getElementById("textReorientate").innerHTML = ' ';
};
</script> 

</head>
<body>

<h1>Tangibles</h1>


<p id="textCalibrate"></p>
<p id="textLoadTangibles"></p>
<p id="textRecognize"></p>
<p id="textReorientate"></p>



<button type="button" onclick="addNewTangible()">Add New</button>
<button type="button" onclick="testSave()">Test Save</button>
<button type="button" onclick="recognize()">Recognize</button>
<button type="button" onclick="testReorientate()">Reorientate</button>
<button type="button" onclick="testIsOverlapped()">Test Overlapping</button>
<br>
<button type="button" onclick="loadTangibles()">Load Tangibles</button>
<button type="button" onclick="deleteTangibles()">Delete All Tangibles</button>
<button type="button" onclick="myFunction()">Run</button>
<button type="button" onclick="myFunction()">Calibrate</button>



</body>
</html>
