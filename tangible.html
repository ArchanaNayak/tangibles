<!DOCTYPE html>
<html>
  <head>
    <title>Touch Tracker Marker</title>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <meta name = "apple-mobile-web-app-capable" content="yes" />
    <link rel="apple-touch-icon" href="image/apple-touch-icon.png" />
    
    <style type="text/css">
      body { margin: 0px; overflow: hidden; background-color: #6eb3ca; }
      canvas { border: 1px solid black; }
    </style>
    <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.2.min.js"></script>
    <!--<script type="text/javascript" src="magictouch.js"></script>-->
    <script type="text/javascript">

      var canvas;
      var ctx;
      var w = 0;
      var h = 0;

      var timer;
      var updateStarted = false;
      var touches = [];

      function drawImage(imageObj) { 
        var stage = new Kinetic.Stage({
          container: "container",
          width: 1000,
          height: 1500
        });
        var layer = new Kinetic.Layer();

        // darth vader
        var darthVaderImg = new Kinetic.Image({
          image: imageObj,
          x: 100,
          y: 30,
          width: 600,
          height: 600,
          draggable: true
        });

        // add cursor styling
        darthVaderImg.on('mouseover', function() {
          document.body.style.cursor = 'pointer';
        });
        darthVaderImg.on('mouseout', function() {
          document.body.style.cursor = 'default';
        });

        layer.add(darthVaderImg);
        stage.add(layer);
      }
      

      function update() {
        if (updateStarted) return;
	      updateStarted = true;

        //var d = [10];

	      var nw = window.innerWidth;
	      var nh = window.innerHeight;

	      if ((w != nw) || (h != nh)) {
		      w = nw;
		      h = nh;
		      canvas.style.width = w+'px';
		      canvas.style.height = h+'px';
		      canvas.width = w;
		      canvas.height = h;
	      }

	      ctx.clearRect(0, 0, w, h);

	      var i, len = touches.length;

	      for (i=0; i<len; i++) {
		      var touch = touches[i];
          var px = touch.pageX;
          var py = touch.pageY;
   
		      ctx.beginPath();
		      ctx.arc(px, py, 20, 0, 2*Math.PI, true);

		      ctx.fillStyle = "rgba(0, 0, 200, 0.2)";
		      ctx.fill();

		      ctx.lineWidth = 2.0;
		      ctx.strokeStyle = "rgba(0, 0, 200, 0.8)";
		      ctx.stroke();

          //with loop
          var d = [];
          var totaldist = 0;

          for(var e=0; e < touches.length; e++) {
            var a23x = touches[e].pageX;    
            var a23y = touches[e].pageY;                
            for (var t = (e + 1); t < touches.length; t++) {
              var b23x = touches[t].pageX;  
              var b23y = touches[t].pageY;
                   
              var d23x = a23x - b23x;
              var d23y = a23y - b23y;
              var distance = Math.sqrt(d23x * d23x + d23y * d23y);

              //console.log(distance);
					    d.push(distance);
            }
          }

          for (var g=0; g < d.length ; g++) {
            totaldist = totaldist+d[g];
          }
          console.log(totaldist);

          if (totaldist>800 && totaldist<900) {
            //document.write("<img border=\"0\" src=\"image002.png\" />"); //grass
            var imageObj = new Image();
            imageObj.onload = function() {
              drawImage(this);
            };
            imageObj.src = 'image002.png';
            return;
          };

          if (totaldist>1500 && totaldist<1600) {
            //document.write("<img border=\"0\" src=\"image003.png\" />"); //grass
            var imageObj = new Image();
            imageObj.onload = function() {
              drawImage(this);
            };
            imageObj.src = 'image003.png';
            return;
          };

          if (totaldist>3500 && totaldist<4570) {
            //document.write("<img border=\"0\" src=\"image001.png\" />"); //grass
            var imageObj = new Image();
            imageObj.onload = function() {
              drawImage(this);
            };
            imageObj.src = 'image001.png';
            return;
          };
        }
        updateStarted = false;
      }

      function ol() {
        canvas = document.getElementById('canvas');
	      ctx = canvas.getContext('2d');
	      timer = setInterval(update, 15);

        canvas.addEventListener('touchend', function() {
	        ctx.clearRect(0, 0, w, h);
        });

        canvas.addEventListener('touchmove', function(event) {
          event.preventDefault();
          touches = event.touches;
        });

        canvas.addEventListener('touchstart', function(event) {
          console.log('start');
        });
      };

    </script>
    <div id="container"></div>
  </head>
  <body onload="ol()">
    <!--Avoid tug in the browser on iPad-->
    <script type=”text/javascript”>// <![CDATA[ function BlockMove(event) { event.preventDefault() ; } // ]]></script>
    
    <canvas id="canvas" width="300" height="300" style="top:0px; left:0px; width: 300px; height: 300px;" border =" 5px solid blue" ></canvas>
    <object id="tuio" type="application/x-tuio">Plugin FAILED to load</object>
  </body>
</html>
